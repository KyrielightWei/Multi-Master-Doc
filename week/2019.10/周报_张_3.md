## 时间
2019年10月21日-2019年10月25日

## 工作列表
+ innobase 文件 IO 的代码详细阅读及总结，了解了 innobase 异步 IO 模型的详细设计。

## 

## 工作详述
+ 工作详细描述 [IO 代码详细总结](http://note.youdao.com/noteshare?id=4078e899c3b81d9abcbe6132e0ee41ba&sub=05DD3C29DFB04B66A2DFD17A71DDF4F1)

## 问题与备注
拆分 IO 子系统的主要问题大概分如下几类：  
1. 和其他模块的耦合成都，说白了，拆出来哪些模块会受到影响；
2. 参数传递：有些参数不能明确长度，可能传进去的只是个单字节指针，但是在调用之后，会指向一块有内容的地址（比如 IO 线程调用 os_aio_handler，传进去一个 
  void *message，传出来的消息类型、大小未知）；
3. 两边的 fd 保持一致，可以将 fd 作为额外信息，在两台机器间传递；
4. 日志序号问题：拆分出来的模块作共享使用，各机器若是单独分配日志，在储存上会不会乱？若是想要将日志有序存到存储，上层该作何改动（是保证日志在全局内不重复，还是加一层 ip 路由来保证一致性）？

拆分方案大概可以分为两种：  
* 第一种是将 os0file 中的全局函数替换为网络调用，直接将 os_aio_handler(线程函数)、os_aio_fun(IO 请求接口) 里面的东西，替换为网络调用，相当于把整个 innobase 文件 IO 放到了存储层，但是线程和 aio array 是绑定的，线程肯定在计算层，若是把 aio array 拆开放到储存层， 会造成很多数据的传递，耗费通信资源。
* 第二种，由于模拟的异步 IO 最终还是调用的 pread、pwrite读写，且模拟异步 IO对请求做了一些优化，可以直接将调用库文件函数的部分改成网络接口。

## 下周工作计划
* 阅读 polarfs 论文，看看他们是如何拆分储存作为独立模块；
* 看 log 部分代码，日志号等是如何分配的，能不能自己加 ip ，做个路由，这样在存储上可以保证日志的唯一性。